categories:
  - java
tags:
  - java
  - 集锦
title: 项目开发问题集锦
date: 2015-12-29 13:58:00
---


[TOC]


## 1. spring容器标签前缀
一般地，spring容器标签bean元数据格式为`<bean></bean>`。但是，奇怪的是有的时候必须使用`<beans:bean></beans:bean>`，否则会报错。

### 为什么会这样？
这与spring容器xml配置当前主要的命名空间(xmlns)设置有关。
由于在同一个xml配置文件中可能会加载多个文档结构定义(DTD)，因此需要使用命名空间来区分开多个DTD中可能相同的文档标签。

例如：spring **tx** schema包含annotation-driven(`<tx:annotation-driven/>`)，同时，spring mvc schema也包含annotation-driven(`<mvc:annotation-driven/>`)

### 小结
对于以上问题描述情况，不需要使用beans前缀的，xmlns是如下情况：
``` xml
<beans xmlns="http://www.springframework.org/schema/beans"
	   xmlns:beans="http://www.springframework.org/schema/beans">
</beans>
```

而对于需要使用beans前缀的，xmlns被修改了，可能是：
``` xml
<beans xmlns="http://www.springframework.org/schema/mvc"
	   xmlns:beans="http://www.springframework.org/schema/beans">
</beans>
```

**由此可知**：
> 使用主命名空间里的标签，命名空间前缀并不是必须的。

### 参考文档
http://bbs.csdn.net/topics/340026084
http://www.w3school.com.cn/tags/tag_prop_xmlns.asp


<!-- more -->

## 2. error at ::0 formal unbound in pointcut[spring aop]

### 传递注解参数给切面缺少注解参数
例如：
``` java
  @Around(value = "point()")
  public void aroundAdvice(ProceedingJoinPoint joinPoint, Retry retry) throws Throwable
```

**正确样例**：
``` java
  @Around(value = "point() && @annotation(retry)")
  public void aroundAdvice(ProceedingJoinPoint joinPoint, Retry retry) throws Throwable
```



## 3. jsp el数值取整
el表达式除法结果为浮点型。

保留整除
<fmt:formatNumber type="number" value="${8/7)}" maxFractionDigits="0"/>
formatNumber

**参考文档**：
http://blog.csdn.net/debbykindom/article/details/5854750


## 4. @ResponseBody返回JSON 不返回值为 null 的字段
``` xml
<mvc:annotation-driven>
    <mvc:message-converters register-defaults="true">
        <bean class="org.springframework.http.converter.json.MappingJackson2HttpMessageConverter">
            <property name="objectMapper">
                <bean class="com.fasterxml.jackson.databind.ObjectMapper">
                    <property name="serializationInclusion">
                        <value type="com.fasterxml.jackson.annotation.JsonInclude.Include">NON_NULL</value>
                    </property>
                </bean>
            </property>
        </bean>
    </mvc:message-converters>
</mvc:annotation-driven>
```

**参考文档**：
http://segmentfault.com/q/1010000002522525


## 5. mvc:view-controller用法

### 重定向
``` xml
<mvc:view-controller path="/" view-name="redirect:/admin/index"/>
```
说明：即如果当前路径是/，则重定向到/admin/index

### view name
```
<mvc:view-controller path="/" view-name="admin/index"/>
```
如果当前路径是/，则交给相应的视图解析器直接解析为视图
如：
``` xml
<bean id="defaultViewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver" p:order="2">
	<property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/>
	<property name="contentType" value="text/html"/>
	<property name="prefix" value="/WEB-INF/jsp/"/>
	<property name="suffix" value=".jsp"/>
</bean>
```
则得到的视图是：/WEB-INF/jsp/admin/index.jsp

**参考**：http://www.iteye.com/topic/1129445


## 6. EL access a map value by Integer key

el表达式中，默认数值类型为Long型。

### 问题描述

**举例说明**：
servlet定义并返回map数据如下：
``` java
Map<Integer, String> map = new HashMap<Integer, String>();
map.put(1, "One");
map.put(2, "Two");
map.put(3, "Three");
```

在jsp页面，通过map[2]不能获取数据Two。因为数值2被装箱成Long型，而map键类型为Integer。
因此，在前端不能通过

### 解决方案

**参考**：http://stackoverflow.com/questions/924451/el-access-a-map-value-by-integer-key

